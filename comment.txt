Flux complet : Backend â†’ MikroTik â†’ App
1ï¸âƒ£ Lâ€™utilisateur initie le paiement

Lâ€™utilisateur ouvre lâ€™app et entre son numÃ©ro de tÃ©lÃ©phone.

Il choisit 200F / 400F.

Lâ€™app fait un POST sur le backend Django :

POST /api/payment/init_wave/
Content-Type: application/json
{
  "phone": "0700000000",
  "amount": 200
}


Backend crÃ©e un Payment en statut PENDING et gÃ©nÃ¨re un MAC unique pour ce tÃ©lÃ©phone.

Backend renvoie le lien Wave (wave_url) Ã  lâ€™app.

2ï¸âƒ£ Lâ€™utilisateur est redirigÃ© vers Wave

Lâ€™utilisateur voit la page Wave pour effectuer le paiement.

Ã€ ce stade :

Le paiement nâ€™est pas encore validÃ©.

Le QR code nâ€™existe pas.

Aucune session Wi-Fi nâ€™est active.

3ï¸âƒ£ Admin confirme le paiement

Lâ€™admin se connecte au dashboard React.

Il voit la liste des paiements PENDING.

Il clique â€œConfirmerâ€ â†’ change le statut en SUCCESS.

4ï¸âƒ£ Backend crÃ©e la session Wi-Fi

Quand le statut passe Ã  SUCCESS :

Django crÃ©e un objet WifiSession :

mac_address = MAC gÃ©nÃ©rÃ© pour ce paiement

phone = numÃ©ro de lâ€™utilisateur

end_time = maintenant + durÃ©e payÃ©e (24h ou 48h)

is_active = True

Optionnel : MikroTik est notifiÃ© via script ou API pour activer la session sur le hotspot.

Le QR code est maintenant gÃ©nÃ©rÃ© et disponible dans lâ€™app.

5ï¸âƒ£ App affiche le QR code

Lâ€™utilisateur revient sur lâ€™app.

Lâ€™app rÃ©cupÃ¨re la session validÃ©e et affiche le QR code correspondant au MAC.

Lâ€™utilisateur peut scanner ce QR code depuis un autre appareil connectÃ© au hotspot, ou le MAC est utilisÃ© directement pour autoriser lâ€™accÃ¨s Wi-Fi.

6ï¸âƒ£ Authentification Wi-Fi

Le hotspot MikroTik reÃ§oit la requÃªte de connexion.

MikroTik vÃ©rifie le MAC auprÃ¨s du backend ou via le script local.

Si le MAC est valide et que la session nâ€™est pas expirÃ©e â†’ lâ€™utilisateur a accÃ¨s Ã  Internet.

Sinon â†’ accÃ¨s refusÃ©.

7ï¸âƒ£ Expiration automatique

Django ou MikroTik fait tourner un cron :

VÃ©rifie end_time des sessions.

DÃ©sactive les sessions expirÃ©es (is_active = False).

Lâ€™utilisateur perd automatiquement lâ€™accÃ¨s Ã  Internet aprÃ¨s la durÃ©e payÃ©e.

RÃ©sumÃ© du rÃ´le de chaque acteur
Acteur	RÃ´le
Utilisateur	Entre son numÃ©ro, choisit le montant, clique sur Wave, scanne le QR code
App React Native	Interface + redirection Wave + affichage QR code aprÃ¨s validation
Backend Django	Enregistre paiement, gÃ©nÃ¨re MAC, valide paiement admin, crÃ©e session Wi-Fi, fournit QR code
Admin Dashboard	Confirme les paiements PENDING â†’ passe Ã  SUCCESS
MikroTik / Hotspot	VÃ©rifie le MAC et la session â†’ autorise ou bloque lâ€™accÃ¨s Internet

ğŸ’¡ Important :

Tant que lâ€™admin nâ€™a pas confirmÃ© â†’ aucune session nâ€™est crÃ©Ã©e â†’ aucun QR code â†’ pas dâ€™accÃ¨s Wi-Fi.

Chaque utilisateur a un MAC unique pour que la session soit individuelle.

La vÃ©rification cÃ´tÃ© MikroTik est la derniÃ¨re couche de sÃ©curitÃ© contre le partage ou le spoofing de MAC.



APP MOBILE
   |
   | (QR CODE)
   v
PAGE WEB PUBLIQUE (Django)
   |
   v
BACKEND (WifiSession)
